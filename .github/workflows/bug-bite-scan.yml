name: Bug Bite Scanner

on:
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  scan-general-files:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Scan .DS_Store
      run: |
        echo "üîç Scanning .DS_Store..."
        if [ -f ".DS_Store" ]; then
          echo "‚úì .DS_Store found and scanned"
          file .DS_Store
        else
          echo "‚ö†Ô∏è  .DS_Store not found"
        fi
    
    - name: Scan .gitignore
      run: |
        echo "üîç Scanning .gitignore..."
        if [ -f ".gitignore" ]; then
          echo "‚úì .gitignore found and scanned"
          wc -l .gitignore
          echo "Checking for common patterns..."
          grep -E "\.DS_Store|node_modules|build|\.swiftpm" .gitignore || echo "Some common patterns may be missing"
        else
          echo "‚ùå .gitignore not found - this is required!"
          exit 1
        fi
    
    - name: Scan DirectorStudio.entitlements
      run: |
        echo "üîç Scanning DirectorStudio.entitlements..."
        if [ -f "DirectorStudio.entitlements" ]; then
          echo "‚úì DirectorStudio.entitlements found and scanned"
          # Validate XML structure
          if command -v xmllint &> /dev/null; then
            xmllint --noout DirectorStudio.entitlements && echo "‚úì Valid XML structure"
          else
            echo "‚ÑπÔ∏è  xmllint not available, skipping XML validation"
          fi
        else
          echo "‚ö†Ô∏è  DirectorStudio.entitlements not found"
        fi
    
    - name: Scan Package.swift
      run: |
        echo "üîç Scanning Package.swift..."
        if [ -f "Package.swift" ]; then
          echo "‚úì Package.swift found and scanned"
          wc -l Package.swift
          echo "Checking for swift-tools-version..."
          grep -E "swift-tools-version" Package.swift || echo "‚ö†Ô∏è  swift-tools-version not found"
        else
          echo "‚ö†Ô∏è  Package.swift not found"
        fi
    
    - name: Scan README.md
      run: |
        echo "üîç Scanning README.md..."
        if [ -f "README.md" ]; then
          echo "‚úì README.md found and scanned"
          wc -l README.md
          echo "Checking for key sections..."
          grep -E "## Overview|## Build|## Features" README.md || echo "‚ö†Ô∏è  Some standard sections may be missing"
        else
          echo "‚ùå README.md not found - this is required!"
          exit 1
        fi
    
    - name: Scan GITHUB_ACTIONS_IPA_SETUP.md
      run: |
        echo "üîç Scanning GITHUB_ACTIONS_IPA_SETUP.md..."
        if [ -f "GITHUB_ACTIONS_IPA_SETUP.md" ]; then
          echo "‚úì GITHUB_ACTIONS_IPA_SETUP.md found and scanned"
          wc -l GITHUB_ACTIONS_IPA_SETUP.md
        else
          echo "‚ö†Ô∏è  GITHUB_ACTIONS_IPA_SETUP.md not found"
        fi
    
    - name: Scan SIGNING_GUIDE.md
      run: |
        echo "üîç Scanning SIGNING_GUIDE.md..."
        if [ -f "SIGNING_GUIDE.md" ]; then
          echo "‚úì SIGNING_GUIDE.md found and scanned"
          wc -l SIGNING_GUIDE.md
        else
          echo "‚ö†Ô∏è  SIGNING_GUIDE.md not found"
        fi
    
    - name: Scan b.md
      run: |
        echo "üîç Scanning b.md..."
        if [ -f "b.md" ]; then
          echo "‚úì b.md found and scanned"
          wc -l b.md
        else
          echo "‚ö†Ô∏è  b.md not found"
        fi
    
    - name: Scan c.md
      run: |
        echo "üîç Scanning c.md..."
        if [ -f "c.md" ]; then
          echo "‚úì c.md found and scanned"
          wc -l c.md
        else
          echo "‚ö†Ô∏è  c.md not found"
        fi
    
    - name: Scan Summary
      run: |
        echo "========================================="
        echo "üéâ Bug Bite Scan Complete!"
        echo "========================================="
        echo "All specified files have been scanned."
        echo ""
        echo "Files scanned:"
        echo "  ‚úì .DS_Store"
        echo "  ‚úì .gitignore"
        echo "  ‚úì DirectorStudio.entitlements"
        echo "  ‚úì Package.swift"
        echo "  ‚úì README.md"
        echo "  ‚úì GITHUB_ACTIONS_IPA_SETUP.md"
        echo "  ‚úì SIGNING_GUIDE.md"
        echo "  ‚úì b.md"
        echo "  ‚úì c.md"
        echo ""
        echo "Review the output above for any warnings or issues."
